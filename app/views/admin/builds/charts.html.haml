= content_for :title do
  %h3.project-title
    Charts

    .pull-right
      %small
        = pluralize(@total_count, 'build')

#charts
  %fieldset
    %legend
      Builds chart for last week
      (#{date_from_to(Date.today - 7.days, Date.today)})

    %canvas#weekChart.padded{width: 800, height: 200}

  %fieldset
    %legend
      Builds chart for last month
      (#{date_from_to(Date.today - 30.days, Date.today)})

    %canvas#monthChart.padded{width: 800, height: 300}

  %fieldset
    %legend Builds chart for last year
    %canvas#yearChart.padded{width: 800, height: 400}

  - [:week, :month, :year].each do |scope|
    :javascript
      var data = {
        labels : #{@charts[scope].labels.to_json},
        datasets : [
          {
            fillColor : "rgba(220,220,220,0.5)",
            strokeColor : "rgba(220,220,220,1)",
            pointColor : "rgba(220,220,220,1)",
            pointStrokeColor : "#EEE",
            data : #{@charts[scope].total.to_json}
          },
          {
            fillColor : "#4A3",
            strokeColor : "rgba(151,187,205,1)",
            pointColor : "rgba(151,187,205,1)",
            pointStrokeColor : "#fff",
            data : #{@charts[scope].success.to_json}
          }
        ]
      }
      var ctx = $("##{scope}Chart").get(0).getContext("2d");
      new Chart(ctx).Line(data,{"scaleOverlay": true});

  %fieldset
    %legend
      Build duration in minutes for last 30 builds

    %canvas#build_timesChart.padded{width: 800, height: 300}

  :javascript
    var data = {
      labels : #{@charts[:build_times].labels.to_json},
      datasets : [
        {
          fillColor : "#4A3",
          strokeColor : "rgba(151,187,205,1)",
          pointColor : "rgba(151,187,205,1)",
          pointStrokeColor : "#fff",
          data : #{@charts[:build_times].build_times.to_json}
        }
      ]
    }
    var ctx = $("#build_timesChart").get(0).getContext("2d");
    new Chart(ctx).Line(data,{"scaleOverlay": true});

  %fieldset
    %legend
      Build wait duration in minutes for last 30 builds

    %canvas#wait_timesChart.padded{width: 800, height: 300}

  :javascript
    var data = {
      labels : #{@charts[:wait_times].labels.to_json},
      datasets : [
        {
          fillColor : "#4A3",
          strokeColor : "rgba(151,187,205,1)",
          pointColor : "rgba(151,187,205,1)",
          pointStrokeColor : "#fff",
          data : #{@charts[:wait_times].build_times.to_json}
        }
      ]
    }
    var ctx = $("#wait_timesChart").get(0).getContext("2d");
    new Chart(ctx).Line(data,{"scaleOverlay": true});

%fieldset
  %legend Overall
  %p
    Total:
    %strong= pluralize @total_count, 'build'
  %p
    Successful:
    %strong= pluralize @success.count, 'build'
  %p
    Failed:
    %strong= pluralize @failed.count, 'build'

  %p
    Success ratio:
    %strong
      #{success_ratio(@success, @failed)}%

  %p
    Commits covered:
    %strong
      = @uniq_sha.count
